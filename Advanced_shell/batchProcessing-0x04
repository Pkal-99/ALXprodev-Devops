#!/bin/bash

# Directory to store Pokémon data
DATA_DIR="pokemon_data"

# Create the directory if it doesn't exist
mkdir -p "$DATA_DIR"

# List of Pokémon to fetch data for
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Function to fetch Pokémon data
fetch_pokemon_data() {
    local pokemon="$1"
    echo "Fetching data for $pokemon..."

    # Initialize variables for attempts
    attempts=0
    max_attempts=3
    success=false

    # Retry logic for API requests
    while [[ $attempts -lt $max_attempts ]]; do
        # Fetch Pokémon data from the API
        response=$(curl -s --fail "https://pokeapi.co/api/v2/pokemon/$pokemon")

        # Check if the request was successful
        if [[ $? -eq 0 && $(echo "$response" | jq -r '.name') == "$pokemon" ]]; then
            # Save data to a file named after the Pokémon
            echo "$response" > "$DATA_DIR/$pokemon.json"
            echo "Saved data to $DATA_DIR/$pokemon.json ✅"
            success=true
            break
        else
            echo "Error fetching data for $pokemon. Attempt $((attempts + 1)) of $max_attempts."
            attempts=$((attempts + 1))
            sleep 1  # Wait 1 second before retrying
        fi
    done

    if [[ $success == false ]]; then
        echo "Failed to fetch data for $pokemon after $max_attempts attempts. Skipping..." >&2
    fi
}

# Loop through the list of Pokémon and fetch data in parallel
for pokemon in "${POKEMON_LIST[@]}"; do
    fetch_pokemon_data "$pokemon" &  # Run the function in the background
done

# Wait for all background processes to complete
wait

echo "All data retrieval attempts completed."